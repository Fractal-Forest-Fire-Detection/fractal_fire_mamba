<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>National Fire Monitoring Service | Fractal Fire Mamba</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header class="gov-header">
    <div class="gov-brand">
      <span class="gov-logo">Official Service</span>
      <h1 class="gov-title">National Forest Fire Monitoring Portal</h1>
    </div>
    <div id="threatBadge" class="status-indicator status--normal">
      NORMAL OPERATIONS
    </div>
  </header>

  <div class="main-layout">
    <!-- LEFT SIDEBAR: Controls & Status -->
    <aside class="sidebar scroll-panel">
      <section class="card">
        <h2 class="card-title">üêù The Hive ‚Äî Node Map</h2>
        <select id="nodeSelector" class="gov-select">
          <option value="ALL">üåè All Regions</option>
          <!-- Populated dynamically from /api/mesh -->
        </select>
      </section>

      <section class="card">
        <h2 class="card-title">Current Risk Assessment</h2>
        <div class="phase-box">
          <div class="phase-dot" id="phaseDot"></div>
          <span id="activePhase">Monitoring</span>
          <div class="risk-score" id="finalRiskDisplay">0.00</div>
        </div>
        <div class="data-row">
          <span class="label">Risk Tier:</span>
          <span class="value" id="riskTier">Low</span>
        </div>
        <div class="data-row">
          <span class="label">System Confidence:</span>
          <span class="value" id="temporalConf">98%</span>
        </div>
      </section>

      <section class="card">
        <h2 class="card-title">Analysis Weights</h2>
        <div class="bar-group">
          <label>Visual Analysis</label>
          <div class="bar">
            <div class="fill" id="wVisBar" style="width:33%"></div>
          </div>
        </div>
        <div class="bar-group">
          <label>Mamba Thermal SSM</label>
          <div class="bar">
            <div class="fill" id="wThermBar" style="width:33%"></div>
          </div>
        </div>
        <div class="bar-group">
          <label>Chemical Signatures</label>
          <div class="bar">
            <div class="fill" id="wChemBar" style="width:33%"></div>
          </div>
        </div>
      </section>

      <div class="card alerts-card">
        <h2 class="card-title">System Alerts</h2>
        <div class="alert-controls">
          <button class="gov-btn doc-btn" id="downloadCsv">CSV</button>
        </div>
        <div id="alertsList">
          <p style="color:var(--text-secondary)">No alerts yet</p>
        </div>
      </div>
    </aside>

    <!-- CENTER PANEL: Map & Telemetry -->
    <main class="center-panel">
      <div class="card map-card">
        <div class="card-header-overlay">
          <h2 class="card-title">Tactical Geographic View</h2>
          <button class="gov-btn btn-danger" id="focusLatestRed">Focus Alert</button>
        </div>
        <div id="map"></div>
      </div>

      <div class="charts-row">
        <div class="card chart-card">
          <h2 class="card-title">Thermal Stability</h2>
          <div class="chart-container"><canvas id="tempChart"></canvas></div>
        </div>
        <div class="card chart-card">
          <h2 class="card-title">Chem vs Visual</h2>
          <div class="chart-container"><canvas id="chemVisChart"></canvas></div>
        </div>
        <div class="card chart-card full-width">
          <h2 class="card-title">Risk Trend (Fused Multi-Modal)</h2>
          <div class="chart-container"><canvas id="fusedChart"></canvas></div>
        </div>
      </div>
    </main>

    <!-- RIGHT PANEL: Deep Analysis -->
    <aside class="right-panel scroll-panel">
      <!-- THE HIVE: Mesh Network Panel -->
      <div class="card mesh-card">
        <h2 class="card-title">üêù Mesh Network ‚Äî The Hive</h2>
        <canvas id="meshCanvas" width="280" height="200"></canvas>
        <div class="mesh-stats">
          <div class="mesh-stat">
            <span class="mesh-stat-label">Nodes</span>
            <span class="mesh-stat-value" id="meshNodeCount">0</span>
          </div>
          <div class="mesh-stat">
            <span class="mesh-stat-label">Routed</span>
            <span class="mesh-stat-value" id="meshMsgCount">0</span>
          </div>
          <div class="mesh-stat">
            <span class="mesh-stat-label">Sat ‚Üë</span>
            <span class="mesh-stat-value" id="meshSatCount">0</span>
          </div>
          <div class="mesh-stat">
            <span class="mesh-stat-label">Aggregated</span>
            <span class="mesh-stat-value" id="meshAggCount">0</span>
          </div>
        </div>
        <div id="meshRelayLog" class="mesh-relay-log">
          <p style="color:#999; font-size:0.8rem;">Waiting for relay events‚Ä¶</p>
        </div>
      </div>

      <div class="card camera-card">
        <h2 class="card-title">Live Camera Feed</h2>
        <div class="camera-box">
          <img id="cameraFeed" src="" alt="Waiting for feed..." style="display:none;" />
          <p id="cameraPlaceholder" style="color:var(--text-secondary); padding:2rem; text-align:center;">[ Signal Lost
            ]</p>
        </div>
        <div class="camera-status" style="margin-top:8px; font-size:0.9rem;">
          <strong>Status:</strong> <span id="camStatus" style="color:var(--gov-green)">ACTIVE</span><br>
          <strong>Mode:</strong> <span id="visionMode">‚Äî</span>
        </div>
      </div>

      <div class="card analysis-card">
        <h2 class="card-title">Fractal & Chaos Analysis</h2>

        <div style="margin-bottom: 20px;">
          <h3>Hurst Exponent (H)</h3>
          <div style="height:100px; width:100%"><canvas id="hurstChart"></canvas></div>
          <div class="metric-row">
            <span>Val: <strong id="hurstVal">‚Äî</strong></span>
            <div class="progress-bg">
              <div id="hurstBar" class="progress-fill" style="width:0%"></div>
            </div>
            <span id="fractalStatus">WAITING</span>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h3>Lyapunov Exponent (Œª)</h3>
          <div style="height:100px; width:100%"><canvas id="lyapunovChart"></canvas></div>
          <div class="metric-row">
            <span>Val: <strong id="lyapVal">‚Äî</strong></span>
            <div class="progress-bg">
              <div id="lyapBar" class="progress-fill" style="width:0%"></div>
            </div>
            <span id="chaosStatus">WAITING</span>
          </div>
        </div>

        <div class="metric-list">
          <h3 style="font-size:0.9rem; color:var(--text-secondary); border-bottom:1px solid #333; padding-bottom:4px;">
            Component Breakdown</h3>
          <div class="metric-item">
            <span>Chemical</span> <span id="scoreChem" style="float:right">‚Äî</span>
            <div class="progress-bg small">
              <div id="barChem" class="progress-fill" style="background:#35b8ff; width:0%"></div>
            </div>
          </div>
          <div class="metric-item">
            <span>Visual</span> <span id="scoreVis" style="float:right">‚Äî</span>
            <div class="progress-bg small">
              <div id="barVis" class="progress-fill" style="background:#9b35ff; width:0%"></div>
            </div>
          </div>
          <div class="metric-item">
            <span>Env</span> <span id="scoreEnv" style="float:right">‚Äî</span>
            <div class="progress-bg small">
              <div id="barEnv" class="progress-fill" style="background:#ffa500; width:0%"></div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <script src="app.js"></script>
</body>

</html>